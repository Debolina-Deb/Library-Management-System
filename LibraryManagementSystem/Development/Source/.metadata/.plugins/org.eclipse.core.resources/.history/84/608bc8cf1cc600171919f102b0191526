package com.cg.library.controller;

import java.sql.Date;
import java.time.LocalDate;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

import com.cg.library.entities.BookRegistration;
import com.cg.library.service.ILibraryService;

@Controller
public class StudentController {

	@Autowired
	ILibraryService studentService;
	
	/**
	 * Method for handling show all book request
	 * 
	 * @param model
	 * @return
	 */
	@RequestMapping("/showAll.htm")
	public String showAllBooks(Model model) {
		try {
			model.addAttribute("bookList", studentService.getAllBooks());
			return "BookSearch";
		} catch (Exception e) {
			model.addAttribute("message", e.getMessage());
			return "Error";
		}
	}
	
	/**
	 * Method used for requesting book by student
	 * 
	 * @param model
	 * @param bookId
	 * @return
	 */
	@RequestMapping("/requestBook.htm")
	public String requestBook(Model model, @RequestParam("bookId") String bookId) {

		try {
			BookRegistration bookRequest = new BookRegistration();
			bookRequest.setBookId(bookId);
			bookRequest.setUserId(studentService.getUserDetails().getUserId());
			bookRequest.setRegistrationDate(Date.valueOf(LocalDate.now()));
			bookRequest = studentService.requestBook(bookRequest);
			model.addAttribute(
					"message",
					"Book is requested with Registration id - "
							+ bookRequest.getRegistrationId());
			return "Success";
		} catch (Exception e) {
			model.addAttribute("message", e.getMessage());
			return "Error";
		}

	}

	@RequestMapping("/searchByAuthor")
	public String searchBookByAuthor(Model model) {
		model.addAttribute("input","0");
		return "SearchByAuthor";
	}

	@RequestMapping(value = "/authorSearch", method = RequestMethod.POST)
	public String searchByAuthor(Model model,
			@RequestParam("author") String author) throws Exception {
		model.addAttribute("bookList", studentService.searchBookByAuthor(author));
		return "BookSearch";
	}
	
	@RequestMapping("/searchByName")
	public String searchBookByName() {
		return "SearchByAuthor";
	}

	@RequestMapping(value = "/bookSearch", method = RequestMethod.POST)
	public String searchByBook(Model model,
			@RequestParam("bookName") String bookName) throws Exception {
		model.addAttribute("bookList", studentService.searchBookByName(bookName));
		return "BookSearch";
	}
}
